# Book API Application

Это RESTful API для книжной библиотеки, он поддерживает регистрацию пользователей, аутентификацию (с использованием JWT), управление книгами и интеграцию с Google Books API.

## Оглавление
- [Требования к проекту](#требования-к-проекту)
- [Используемые технологии](#используемые-технологии)
- [Инструкции по установке](#инструкции-по-установке)
  - [Предварительные требования](#предварительные-требования)
  - [Клонирование репозитория](#клонирование-репозитория)
  - [Установка зависимостей](#установка-зависимостей)
  - [Настройка базы данных](#настройка-базы-данных)
  - [Конфигурация](#конфигурация)
  - [Запуск сервера разработки](#запуск-сервера-разработки)
- [API-эндпоинты](#api-эндпоинты)
  - [Аутентификация и пользователи](#аутентификация-и-пользователи)
  - [Управление книгами](#управление-книгами)
  - [Интеграция с Google Books API](#интеграция-с-google-books-api)
- [Форматирование кода](#форматирование-кода)
- [Тестирование](#тестирование)

## Требования к проекту
- Язык программирования: PHP 8.2+
- База данных: MySQL 8
- База данных спроектирована в 3-й нормальной форме
- Результат API в формате JSON
- API соответствует стандартам REST API
- Код не должен содержать SQL-уязвимостей
- Использование сторонних библиотек: Опционально (используется Firebase/php-jwt)
- Реализация сервисного слоя для бизнес-логики
- Приложение использует архитектурный паттерн MVC

## Используемые технологии
- PHP 8.2+
- MySQL 8
- Composer для управления зависимостями
- Firebase/php-jwt для аутентификации JWT

## Инструкции по установке

### Предварительные требования
Перед началом убедитесь, что в вашей системе установлено следующее:
- **PHP 8.2** или выше
- **Composer**
- **MySQL 8** или совместимый сервер баз данных

### Клонирование репозитория
```bash
git clone https://github.com/N-i-Kit-OS/book-api.git
cd book-api
```

### Установка зависимостей
Перейдите в корневой каталог проекта и установите PHP-зависимости с помощью Composer:
```bash
composer install
```

### Настройка базы данных
1.  Убедитесь, что ваш сервер MySQL запущен.
2.  Импортируйте предоставленную схему SQL для создания базы данных `library_db` и ее таблиц:
    ```bash
    mysql -u root -p < database/schema.sql
    ```
    Вам будет предложено ввести пароль пользователя MySQL `root`.

3.  При необходимости обновите данные для подключения к базе данных в `config/database.php`:
    ```php
    // config/database.php
    return [
        'host' => 'localhost',
        'dbname' => 'library_db',
        'username' => 'root',
        'password' => '', // <--- Установите здесь свой пароль пользователя MySQL root
        'charset' => 'utf8mb4'
    ];
    ```

### Конфигурация
1.  **Секретный ключ JWT:**
    Приложение использует секретный ключ JWT для генерации и проверки токенов. Этот ключ хранится в `config/app.php`. Вы **ДОЛЖНЫ** заменить заполнитель своим собственным надежным, случайно сгенерированным ключом.
    
    Вы можете сгенерировать подходящий ключ с помощью PHP:
    ```bash
    php -r "echo bin2hex(random_bytes(32)) . PHP_EOL;"
    ```
    Затем обновите `config/app.php`:
    ```php
    // config/app.php
    return [
        'jwt_secret_key' => 'ВАШ_СУПЕР_СЕКРЕТНЫЙ_КЛЮЧ_JWT_ЗДЕСЬ',
    ];
    ```

### Запуск сервера разработки
Перейдите в корневой каталог проекта и запустите встроенный сервер разработки PHP:
```bash
php -S localhost:8000 -t public/
```
API будет доступен по адресу `http://localhost:8000`.

## API-эндпоинты
Все API-эндпоинты возвращают ответы в формате JSON.

### Аутентификация и пользователи
-   **`POST /api/register`**
    -   Регистрирует нового пользователя.
    -   Тело запроса: `{ "login": "string", "password": "string" }`
-   **`POST /api/login`**
    -   Аутентифицирует пользователя и возвращает токен JWT.
    -   Тело запроса: `{ "login": "string", "password": "string" }`
    -   Возвращает: `{ "token": "string" }`
-   **`GET /api/users`** (Защищено)
    -   Получает список всех зарегистрированных пользователей (ID и логин).
    -   Заголовки: `Authorization: Bearer <JWT_ТОКЕН>`
-   **`POST /api/grant-access`** (Защищено)
    -   Предоставляет другому пользователю доступ к вашей библиотеке.
    -   Заголовки: `Authorization: Bearer <JWT_ТОКЕН>`
    -   Тело запроса: `{ "granted_user_id": "integer" }`

### Управление книгами
-   **`POST /api/books`** (Защищено)
    -   Создает новую книгу. Поддерживает текстовое содержимое через JSON или загрузку файла через `multipart/form-data`.
    -   Заголовки: `Authorization: Bearer <JWT_ТОКЕН>`
    -   Тело запроса (JSON): `{ "title": "string", "content": "string" }`
    -   ИЛИ Тело запроса (`form-data`): `title="string"`, `book_file="file (text/plain)"`
-   **`GET /api/books`** (Защищено)
    -   Получает список книг, принадлежащих аутентифицированному пользователю.
    -   Заголовки: `Authorization: Bearer <JWT_ТОКЕН>`
-   **`GET /api/books/{id}`** (Защищено)
    -   Получает конкретную книгу по ее ID, если она принадлежит аутентифицированному пользователю.
    -   Заголовки: `Authorization: Bearer <JWT_ТОКЕН>`
-   **`PUT /api/books/{id}`** (Защищено)
    -   Обновляет существующую книгу по ее ID, если она принадлежит аутентифицированному пользователю.
    -   Заголовки: `Authorization: Bearer <JWT_ТОКЕН>`, `Content-Type: application/json`
    -   Тело запроса: `{ "title": "string", "content": "string" }`
-   **`DELETE /api/books/{id}`** (Защищено)
    -   Мягко удаляет книгу по ее ID, если она принадлежит аутентифицированному пользователю.
    -   Заголовки: `Authorization: Bearer <JWT_ТОКЕН>`
-   **`POST /api/books/{id}/restore`** (Защищено)
    -   Восстанавливает мягко удаленную книгу по ее ID, если она принадлежит аутентифицированному пользователю.
    -   Заголовки: `Authorization: Bearer <JWT_ТОКЕН>`
-   **`GET /api/users/{userId}/books`** (Защищено)
    -   Получает список книг для указанного ID пользователя, если аутентифицированному пользователю был предоставлен доступ.
    -   Заголовки: `Authorization: Bearer <JWT_ТОКЕН>`

### Интеграция с Google Books API
-   **`GET /api/books/search?q={query}`** (Защищено)
    -   Ищет книги с использованием Google Books API.
    -   Заголовки: `Authorization: Bearer <JWT_ТОКЕН>`
    -   Параметр запроса: `q` (термин для поиска)
-   **`POST /api/books/save-found`** (Защищено)
    -   Сохраняет книгу, найденную через Google Books API, в библиотеку пользователя.
    -   Заголовки: `Authorization: Bearer <JWT_ТОКЕН>`, `Content-Type: application/json`
    -   Тело запроса: `{ "title": "string", "description": "string (optional)", "info_link": "string (optional)", "google_book_id": "string" }`

## Форматирование кода
Этот проект использует `php-cs-fixer` для обеспечения стиля кода (стандарт PSR-12).
Вы можете автоматически исправить проблемы со стилем кода, запустив:
```bash
composer cs-fix
```
Чтобы проверить наличие проблем без применения исправлений:
```bash
composer cs-check
```

## Тестирование
Комплексное тестирование API может быть выполнено с использованием таких инструментов, как Postman. Обратитесь к подробной документации по тестированию в Postman, предоставленной отдельно, для всех возможных сценариев запросов и ожидаемых ответов.
